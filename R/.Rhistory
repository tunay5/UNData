data_flow <- function(){
url_1 <- "https://data.un.org/ws/rest/dataflow/"
page_1<- xml2::read_xml(url_1)
ids <- xml2::xml_attr(xml2::xml_find_all(page_1, "//structure:Dataflow"),"id")
titles <- xml2::xml_text(xml2::xml_find_all(page_1, "//*[@xml:lang='en']"))
ref_ids <- xml2::xml_attr(xml2::xml_find_all(page_1, "//Ref"),"id")
agency_ids <- xml2::xml_attr(xml2::xml_find_all(page_1, "//Ref"),"agencyID")
titles <- titles[-10]
dataflow <- data.frame(titles, ids, ref_ids, agency_ids)
dataflow
}
data_structure <- function(dataflow){
data <- data_flow() |> dplyr::filter(ids == dataflow)
ref_id <- data[1,3]
agency_id <- data[1,4]
url <- paste0("https://data.un.org/ws/rest/datastructure/",agency_id,"/",ref_id,"/?references=children")
page <- xml2::read_xml(url)
codelist <- xml2::xml_attr(xml2::xml_find_all(page, "//structure:Codelist"),"id")
list_1 <- list()
for(i in 1:length(codelist)){
name <- codelist[i]
as <- paste0(paste("//*[@id = '", name, "'", sep = ""),"]")
list_1[[i]] <- data.frame(title = xml2::xml_text(xml2::xml_children(xml2::xml_find_all(page,as))),
id = xml2::xml_attr(xml2::xml_children(xml2::xml_find_all(page, as)),"id"))
names(list_1)[i] <- name
}
assign(paste0("list_", dataflow), list_1, env = .GlobalEnv)
print(summary(list_1))
}
data_structure("DF_UNDATA_ENERGY")
View(list_DF_UNDATA_ENERGY)
data_structure <- function(dataflow){
data <- data_flow() |> dplyr::filter(ids == dataflow)
ref_id <- data[1,3]
agency_id <- data[1,4]
url <- paste0("https://data.un.org/ws/rest/datastructure/",agency_id,"/",ref_id,"/?references=children")
page <- xml2::read_xml(url)
codelist <- xml2::xml_attr(xml2::xml_find_all(page, "//structure:Codelist"),"id")
names_of_codelist <- xml2::attr(xml2::xml_find_all(page, "//structure:Dimension")"id")
data_structure <- function(dataflow){
data <- data_flow() |> dplyr::filter(ids == dataflow)
ref_id <- data[1,3]
agency_id <- data[1,4]
url <- paste0("https://data.un.org/ws/rest/datastructure/",agency_id,"/",ref_id,"/?references=children")
page <- xml2::read_xml(url)
codelist <- xml2::xml_attr(xml2::xml_find_all(page, "//structure:Codelist"),"id")
names_of_codelist <- xml2::attr(xml2::xml_find_all(page, "//structure:Dimension"),"id")
list_1 <- list()
for(i in 1:length(name_of_codelist)){
name <- codelist[i]
name_1 <-
as <- paste0(paste("//*[@id = '", name, "'", sep = ""),"]")
list_1[[i]] <- data.frame(title = xml2::xml_text(xml2::xml_children(xml2::xml_find_all(page,as))),
id = xml2::xml_attr(xml2::xml_children(xml2::xml_find_all(page, as)),"id"))
names(list_1)[i] <- names_of_codelist[i]
}
assign(paste0("list_", dataflow), list_1, env = .GlobalEnv)
print(summary(list_1))
}
data_structure("DF_UNDATA_ENERGY")
data_structure <- function(dataflow){
data <- data_flow() |> dplyr::filter(ids == dataflow)
ref_id <- data[1,3]
agency_id <- data[1,4]
url <- paste0("https://data.un.org/ws/rest/datastructure/",agency_id,"/",ref_id,"/?references=children")
page <- xml2::read_xml(url)
codelist <- xml2::xml_attr(xml2::xml_find_all(page, "//structure:Codelist"),"id")
names_of_codelist <- xml2::xml_attr(xml2::xml_find_all(page, "//structure:Dimension"),"id")
list_1 <- list()
for(i in 1:length(name_of_codelist)){
name <- codelist[i]
name_1 <-
as <- paste0(paste("//*[@id = '", name, "'", sep = ""),"]")
list_1[[i]] <- data.frame(title = xml2::xml_text(xml2::xml_children(xml2::xml_find_all(page,as))),
id = xml2::xml_attr(xml2::xml_children(xml2::xml_find_all(page, as)),"id"))
names(list_1)[i] <- names_of_codelist[i]
}
assign(paste0("list_", dataflow), list_1, env = .GlobalEnv)
print(summary(list_1))
}
data_structure("DF_UNDATA_ENERGY")
data_structure <- function(dataflow){
data <- data_flow() |> dplyr::filter(ids == dataflow)
ref_id <- data[1,3]
agency_id <- data[1,4]
url <- paste0("https://data.un.org/ws/rest/datastructure/",agency_id,"/",ref_id,"/?references=children")
page <- xml2::read_xml(url)
codelist <- xml2::xml_attr(xml2::xml_find_all(page, "//structure:Codelist"),"id")
names_of_codelist <- xml2::xml_attr(xml2::xml_find_all(page, "//structure:Dimension"),"id")
list_1 <- list()
for(i in 1:length(names_of_codelist)){
name <- codelist[i]
name_1 <-
as <- paste0(paste("//*[@id = '", name, "'", sep = ""),"]")
list_1[[i]] <- data.frame(title = xml2::xml_text(xml2::xml_children(xml2::xml_find_all(page,as))),
id = xml2::xml_attr(xml2::xml_children(xml2::xml_find_all(page, as)),"id"))
names(list_1)[i] <- names_of_codelist[i]
}
assign(paste0("list_", dataflow), list_1, env = .GlobalEnv)
print(summary(list_1))
}
data_structure("DF_UNDATA_ENERGY")
data_structure <- function(dataflow){
data <- data_flow() |> dplyr::filter(ids == dataflow)
ref_id <- data[1,3]
agency_id <- data[1,4]
url <- paste0("https://data.un.org/ws/rest/datastructure/",agency_id,"/",ref_id,"/?references=children")
page <- xml2::read_xml(url)
codelist <- xml2::xml_attr(xml2::xml_find_all(page, "//structure:Codelist"),"id")
names_of_codelist <- xml2::xml_attr(xml2::xml_find_all(page, "//structure:Dimension"),"id")
names_of_codelist <- names_of_codelist[!is.na(names_of_codelist)]
list_1 <- list()
for(i in 1:length(names_of_codelist)){
name <- codelist[i]
name_1 <-
as <- paste0(paste("//*[@id = '", name, "'", sep = ""),"]")
list_1[[i]] <- data.frame(title = xml2::xml_text(xml2::xml_children(xml2::xml_find_all(page,as))),
id = xml2::xml_attr(xml2::xml_children(xml2::xml_find_all(page, as)),"id"))
names(list_1)[i] <- names_of_codelist[i]
}
assign(paste0("list_", dataflow), list_1, env = .GlobalEnv)
print(summary(list_1))
}
data_structure("DF_UNDATA_ENERGY")
View(list_DF_UNDATA_ENERGY)
list_DF_UNDATA_ENERGY[[1]]
list_DF_UNDATA_ENERGY[[2]]
list_DF_UNDATA_ENERGY[[3]]
list_DF_UNDATA_ENERGY[[4]]
View(list_DF_UNDATA_ENERGY[[3]])
View(list_DF_UNDATA_ENERGY[[2]])
data_structure <- function(dataflow){
data <- data_flow() |> dplyr::filter(ids == dataflow)
ref_id <- data[1,3]
agency_id <- data[1,4]
url <- paste0("https://data.un.org/ws/rest/datastructure/",agency_id,"/",ref_id,"/?references=children")
page <- xml2::read_xml(url)
codelist <- xml2::xml_attr(xml2::xml_find_all(page, "//structure:Codelist"),"id")
names_of_codelist <- xml2::xml_attr(xml2::xml_find_all(page, "//structure:Dimension"),"id")
names_of_codelist <- names_of_codelist[!is.na(names_of_codelist)]
list_1 <- list()
for(i in 1:length(names_of_codelist)){
name <- codelist[i]
name_1 <-
as <- paste0(paste("//*[@id = '", name, "'", sep = ""),"]")
list_1[[i]] <- data.frame(title = xml2::xml_text(xml2::xml_children(xml2::xml_find_all(page,as))),
id = xml2::xml_attr(xml2::xml_children(xml2::xml_find_all(page, as)),"id"))
names(list_1)[i] <- paste0(names_of_codelist[i],"/",codelist[i])
}
assign(paste0("list_", dataflow), list_1, env = .GlobalEnv)
print(summary(list_1))
}
View(list_DF_UNDATA_ENERGY[[2]])
list_DF_UNDATA_ENERGY[[4]]
data_structure("DF_UNDATA_ENERGY")
View(list_DF_UNDATA_ENERGY)
gsub("@.*","ad@sd")
gsub("@.*","","ad@sd")
gsub(".*@","","ad@sd")
gsub(".*/","","FREQ/ASD")
