for(i in 1:length(names_of_codelist)){
name <- codelist[i]
as <- paste0(paste("//*[@id = '", name, "'", sep = ""),"]")
data <- data.frame(title = xml2::xml_text(xml2::xml_children(xml2::xml_find_all(page,as))),
id = xml2::xml_attr(xml2::xml_children(xml2::xml_find_all(page, as)),"id"))
data <- data |> tidyr::drop_na()
list_1[[i]] <- data
names(list_1)[i] <- paste0(names_of_codelist[i],"/",codelist[i])
}
assign(paste0("list_", dataflow), list_1, env = .GlobalEnv)
list_1
}
get_data <- function(dataflow, filter = NULL, start = NULL , end = NULL){
data <- data_structure(dataflow)
list_1 <- list()
for(i in 1:length(data)){
data_1 <- data[[i]]
name_data <- gsub("/.*","",names(data)[i])
for (a in 1:length(filter)) {
filter_1 <- filter[[a]]
id_filter_1 <- intersect(as.vector(data_1[,2]), as.vector(filter_1))
title_filter_1 <- intersect(name_data, as.vector(filter_1))
if(length(id_filter_1)!=0 & length(title_filter_1)!=0){
d <- c(id_filter_1)
break
}else{
d <- NULL
next
}
}
if(!is.null(d)){
list_1[[i]] <- d
}else{
list_1[[i+1]] <- "as"
list_1[[i+1]] <- d
}
}
get_final_data <- rsdmx::readSDMX(providerId = "UNSD", resource = "data", flowRef = as.character(dataflow),
key = list_1)
get_final_dataset <- data.frame(get_final_data)
get_final_dataset
}
data_structure("SEEAAIR")
View(list_SEEAAIR)
data_structure <- function(dataflow){
data <- data_flow() |> dplyr::filter(ids == dataflow)
ref_id <- data[1,3]
agency_id <- data[1,4]
url <- paste0("https://data.un.org/ws/rest/datastructure/",agency_id,"/",ref_id,"/?references=children")
page <- xml2::read_xml(url)
codelist <- xml2::xml_attr(xml2::xml_find_all(page, "//structure:Codelist"),"id")
names_of_codelist <- xml2::xml_attr(xml2::xml_find_all(page, "//structure:Dimension"),"id")
names_of_codelist <- names_of_codelist[!is.na(names_of_codelist)]
list_1 <- list()
for(i in 1:length(names_of_codelist)){
name <- codelist[i]
as <- paste0(paste("//*[@id = '", name, "'", sep = ""),"]")
data <- data.frame(title = xml2::xml_text(xml2::xml_children(xml2::xml_find_all(page,as))),
id = xml2::xml_attr(xml2::xml_children(xml2::xml_find_all(page, as)),"id"))
data <- data |> tidyr::drop_na()
list_1[[i]] <- data
names(list_1)[i] <- paste0(names_of_codelist[i])
}
assign(paste0("list_", dataflow), list_1, env = .GlobalEnv)
list_1
}
data_structure("SEEAAIR")
View(list_SEEAAIR)
data_structure <- function(dataflow){
data <- data_flow() |> dplyr::filter(ids == dataflow)
ref_id <- data[1,3]
agency_id <- data[1,4]
url <- paste0("https://data.un.org/ws/rest/datastructure/",agency_id,"/",ref_id,"/?references=children")
page <- xml2::read_xml(url)
codelist <- xml2::xml_attr(xml2::xml_find_all(page, "//structure:Codelist"),"id")
names_of_codelist <- xml2::xml_attr(xml2::xml_find_all(page, "//structure:Dimension"),"id")
names_of_codelist <- names_of_codelist[!is.na(names_of_codelist)]
list_1 <- list()
for(i in 1:length(names_of_codelist)){
name <- codelist[i]
as <- paste0(paste("//*[@id = '", name, "'", sep = ""),"]")
data <- data.frame(title = xml2::xml_text(xml2::xml_children(xml2::xml_find_all(page,as))),
id = xml2::xml_attr(xml2::xml_children(xml2::xml_find_all(page, as)),"id"))
data <- data |> tidyr::drop_na()
list_1[[i]] <- data
names(list_1)[i] <- paste0(names_of_codelist[i],"/",codelist[i])
}
assign(paste0("list_", dataflow), list_1, env = .GlobalEnv)
list_1
}
View(list_SEEAAIR)
data_structure("SEEAAIR")
data_structure("SEEAAIR")
data_structure("SEEAAIR")
data_structure("SEEAAIR")
View(list_SEEAAIR)
data <- data_flow()
data_structure("DF_UNData_UNFCC")
View(list_DF_UNData_UNFCC)
data_structure <- function(dataflow){
data <- data_flow() |> dplyr::filter(ids == dataflow)
ref_id <- data[1,3]
agency_id <- data[1,4]
url <- paste0("https://data.un.org/ws/rest/datastructure/",agency_id,"/",ref_id,"/?references=children")
page <- xml2::read_xml(url)
codelist <- xml2::xml_attr(xml2::xml_find_all(page, "//structure:Codelist"),"id")
list_1 <- list()
for(i in 1:length(codelist)){
name <- codelist[i]
as <- paste0(paste("//*[@id = '", name, "'", sep = ""),"]")
data <- data.frame(title = xml2::xml_text(xml2::xml_children(xml2::xml_find_all(page,as))),
id = xml2::xml_attr(xml2::xml_children(xml2::xml_find_all(page, as)),"id"))
data <- data |> tidyr::drop_na()
list_1[[i]] <- data
names(list_1)[i] <- paste0(codelist[i])
}
assign(paste0("list_", dataflow), list_1, env = .GlobalEnv)
list_1
}
data_structure("SEEAAIR")
View(list_SEEAAIR)
data_structure("DF_UNDATA_UNFCC")
data_structure("DF_UNdata_UNFCC")
data_structure("DF_UNData_UNFCC")
View(list_DF_UNData_UNFCC)
gsub(".*_","CL_REF")
gsub(".*_","","CL_REF")
gsub(".*_","","CL_REF_AS")
gsub("[.*_]","","CL_REF_AS")
gsub(".*_","","CL_REF_AS")
gsub("_.*","","CL_REF_AS")
gsub("\\_.*","","CL_REF_AS")
gsub("\\.*_","","CL_REF_AS")
gsub(".*_","","CL_REF_AS")
gsub("\\.*_","","CL_REF_AS")
gsub("^.*_","","CL_REF_AS")
gsub(".*_","","CL_REF_AS")
gsub("[^.*_]","","CL_REF_AS")
gsub("[.*_]","","CL_REF_AS")
asd <- "I want to remove. This part of. the File name.jpg
"
gsub("([^.]+)", "", asd)
gsub("([.]+)", "", asd)
gsub("[^.]+\.[^.]+", "", asd)
gsub("([^.]+\.[^.]+)", "", asd)
gsub(".*_", "", "CL_FREQ")
gsub(".*_", "", "CL_FREQ_D")
sub("_([^_]*)$", "\\1", "CL_FREQ_D")
library(stringr)
str_locate_all("CL_FREQ_D","_")[[1]]
SAD <- str_locate_all("CL_FREQ_D","_")[[1]]
SAD[nrow(SAD)]
SAD[nrow(SAD),]
str_sub("CL_FREQ_D", 8,8)
str_sub("CL_FREQ_D", 8,8) <- ""
str_sub("CL_FREQ_D", 8,8) <- "1"
x3 <- "CL_FREQ_D"
str_sub(x3, 8,8) <- ""
x3
alt_pos <- str_locate("CL_FREQ_D", "_")[[1]]
alt_pos[length(alt_pos),]
alt_pos[nrow(alt_pos),]
alt_pos
rm(alt_pos,asd,x3)
rm(SAD)
alt_pos <- stringr::str_locate_all("CL_FREQ_D","_")[[1]]
alt_pos
rm(alt_pos)
names <- "CL_FREQ_D"
alt_pos <- stringr::str_locate_all(names,"_")[[1]]
alt_pos
alt_pos_first <- alt_pos[1,]
str_sub(names,alt_pos_first[1],alt_pos_first[2]) <- ""
names
str_sub(names,alt_pos_first[1],alt_pos_first[2]) <- "."
names <- "CL_FREQ_D"
alt_pos <- stringr::str_locate_all(names,"_")[[1]]
alt_pos_first <- alt_pos[1,]
str_sub(names,alt_pos_first[1],alt_pos_first[2]) <- "."
names
gsub(".*.","",names)
str_sub(names,alt_pos_first[1],alt_pos_first[2]) <- ","
gsub(".*,","",names)
names <- "CL_FREQ"
alt_pos <- stringr::str_locate_all(names,"_")[[1]]
alt_pos_first <- alt_pos[1,]
str_sub(names,alt_pos_first[1],alt_pos_first[2]) <- ","
names
alt_pos <- stringr::str_locate_all(names,"_")[[1]]
names <- "CL_FREQ_D"
alt_pos <- stringr::str_locate_all(names,"_")[[1]]
alt_pos_first <- alt_pos[2,]
str_sub(names,alt_pos_first[1],alt_pos_first[2]) <- ""
names
str_sub(names,alt_pos_first[1],alt_pos_first[2]) <- ","
names
"
alt_pos <- stringr::str_locate_all(names,"_")[[1]]
alt_pos_first <- alt_pos[2,]
str_sub(names,alt_pos_first[1],alt_pos_first[2]) <- ","
names <- "CL_FREQ_D"
alt_pos <- stringr::str_locate_all(names,"_")[[1]]
alt_pos_first <- alt_pos[2,]
str_sub(names,alt_pos_first[1],alt_pos_first[2]) <- ","
names
gsub(".*,","",names)
gsub(",.*","",names)
gsub("_","",gsub(",.*","",names))
gsub(".*_","",gsub(",.*","",names))
names <- "CL_FREQ"
alt_pos <- stringr::str_locate_all(names,"_")[[1]]
alt_pos_first <- alt_pos[2,]
names <- "CL_FREQ_D"
alt_pos <- stringr::str_locate_all(names,"_")[[1]]
alt_pos_first <- alt_pos[2,]
str_sub(names,alt_pos_first[1],alt_pos_first[2]) <- ","
gsub(".*,","",names)
gsub(",.*","",names)
alt_pos
names <- "CL_FREQ"
alt_pos <- stringr::str_locate_all(names,"_")[[1]]
alt_pos_first <- alt_pos[1,]
str_sub(names,alt_pos_first[1],alt_pos_first[2]) <- ","
gsub(",.*","",names)
gsub(".*,","",names)
names <- "CL_FREQ_D"
alt_pos <- stringr::str_locate_all(names,"_")[[1]]
alt_pos_first <- alt_pos[1,]
str_sub(names,alt_pos_first[1],alt_pos_first[2]) <- ","
names
gsub(".*,","",names)
gsub("_.*","",gsub(".*,","",names))
get_data <- function(dataflow, filter = NULL, start = NULL , end = NULL){
data <- data_structure(dataflow)
list_1 <- list()
for(i in 1:length(data)){
data_1 <- data[[i]]
names <- names(data)[i]
alt_pos <- stringr::str_locate_all(names,"_")[[1]]
if(nrow(alt_pos)==1){
alt_pos_first <- alt_pos[1,]
str_sub(names,alt_pos_first[1],alt_pos_first[2]) <- ","
name_data <- gsub(".*,","",names)
}else{
alt_pos_first <- alt_pos[1,]
str_sub(names(data)[i],alt_pos_first[1],alt_pos_first[2]) <- ","
name_data <- gsub("_.*","",gsub(".*,","",names))
}
for (a in 1:length(filter)) {
filter_1 <- filter[[a]]
id_filter_1 <- intersect(as.vector(data_1[,2]), as.vector(filter_1))
title_filter_1 <- intersect(name_data, as.vector(filter_1))
if(length(id_filter_1)!=0 & length(title_filter_1)!=0){
d <- c(id_filter_1)
break
}else{
d <- NULL
next
}
}
if(!is.null(d)){
list_1[[i]] <- d
}else{
list_1[[i+1]] <- "as"
list_1[[i+1]] <- d
}
}
get_final_data <- rsdmx::readSDMX(providerId = "UNSD", resource = "data", flowRef = as.character(dataflow),
key = list_1)
get_final_dataset <- data.frame(get_final_data)
get_final_dataset
}
data_structure <- function(dataflow){
data <- data_flow() |> dplyr::filter(ids == dataflow)
ref_id <- data[1,3]
agency_id <- data[1,4]
url <- paste0("https://data.un.org/ws/rest/datastructure/",agency_id,"/",ref_id,"/?references=children")
page <- xml2::read_xml(url)
codelist <- xml2::xml_attr(xml2::xml_find_all(page, "//structure:Codelist"),"id")
list_1 <- list()
for(i in 1:length(codelist)){
name <- codelist[i]
as <- paste0(paste("//*[@id = '", name, "'", sep = ""),"]")
data <- data.frame(title = xml2::xml_text(xml2::xml_children(xml2::xml_find_all(page,as))),
id = xml2::xml_attr(xml2::xml_children(xml2::xml_find_all(page, as)),"id"))
data <- data |> tidyr::drop_na()
list_1[[i]] <- data
names(list_1)[i] <- paste0(codelist[i])
}
assign(paste0("list_", dataflow), list_1, env = .GlobalEnv)
list_1
}
data_structure("DF_UNData_UNFCC")
View(list_DF_UNData_UNFCC)
data_structure("SEEAAIR")
View(list_SEEAAIR)
gsub(",.*","", names)
gsub(".*,","", names)
data_structure <- function(dataflow){
data <- data_flow() |> dplyr::filter(ids == dataflow)
ref_id <- data[1,3]
agency_id <- data[1,4]
url <- paste0("https://data.un.org/ws/rest/datastructure/",agency_id,"/",ref_id,"/?references=children")
page <- xml2::read_xml(url)
codelist <- xml2::xml_attr(xml2::xml_find_all(page, "//structure:Codelist"),"id")
list_1 <- list()
for(i in 1:length(codelist)){
name <- codelist[i]
as <- paste0(paste("//*[@id = '", name, "'", sep = ""),"]")
data <- data.frame(title = xml2::xml_text(xml2::xml_children(xml2::xml_find_all(page,as))),
id = xml2::xml_attr(xml2::xml_children(xml2::xml_find_all(page, as)),"id"))
data <- data |> tidyr::drop_na()
list_1[[i]] <- data
names_data <- paste0(codelist[i])
alt_pos <- stringr::str_locate_all(names_data, "_")[[1]]
if(nrow(alt_pos)==1){
alt_pos_first <- alt_pos[1,]
str_sub(names_data, alt_pos_first[1],alt_pos_first[2]) <- ","
names_data <- gsub(",.*","", names_data)
}else{
alt_pos_first <- alt_pos[2,]
str_sub(names_data, alt_pos_first[1],alt_pos_first[2]) <- ","
names_data <- gsub("_.*","",gsub(".*,","", names_data))
}
names(list_1)[i] <- names_data
}
assign(paste0("list_", dataflow), list_1, env = .GlobalEnv)
list_1
}
data_structure("DF_UNData_UNFCC")
View(list_DF_UNData_UNFCC)
data_structure <- function(dataflow){
data <- data_flow() |> dplyr::filter(ids == dataflow)
ref_id <- data[1,3]
agency_id <- data[1,4]
url <- paste0("https://data.un.org/ws/rest/datastructure/",agency_id,"/",ref_id,"/?references=children")
page <- xml2::read_xml(url)
codelist <- xml2::xml_attr(xml2::xml_find_all(page, "//structure:Codelist"),"id")
list_1 <- list()
for(i in 1:length(codelist)){
name <- codelist[i]
as <- paste0(paste("//*[@id = '", name, "'", sep = ""),"]")
data <- data.frame(title = xml2::xml_text(xml2::xml_children(xml2::xml_find_all(page,as))),
id = xml2::xml_attr(xml2::xml_children(xml2::xml_find_all(page, as)),"id"))
data <- data |> tidyr::drop_na()
list_1[[i]] <- data
names_data <- paste0(codelist[i])
alt_pos <- stringr::str_locate_all(names_data, "_")[[1]]
if(nrow(alt_pos)==1){
alt_pos_first <- alt_pos[1,]
str_sub(names_data, alt_pos_first[1],alt_pos_first[2]) <- ","
names_data <- gsub(".*,","", names_data)
}else{
alt_pos_first <- alt_pos[2,]
str_sub(names_data, alt_pos_first[1],alt_pos_first[2]) <- ","
names_data <- gsub("_.*","",gsub(".*,","", names_data))
}
names(list_1)[i] <- names_data
}
assign(paste0("list_", dataflow), list_1, env = .GlobalEnv)
list_1
}
data_structure("DF_UNData_UNFCC")
View(list_DF_UNData_UNFCC)
na <- "CL_REF_AREA"
alt_pos <- str_locate_all(na, "_")[[1]]
alt_pos_first <- alt_pos[2,]
str_sub(names_data, alt_pos_first[1],alt_pos_first[2]) <- ","
str_sub(na, alt_pos_first[1],alt_pos_first[2]) <- ","
na
names_data <- gsub("_.*","",gsub(".*,","", names_data))
names_data <- gsub("_.*","",gsub(".*,","", na))
names_data
na <- "CL_REF_AREA"
na <- "CL_REF_AREA"
alt_pos <- str_locate_all(na, "_")[[1]]
alt_pos_first <- alt_pos[1,]
str_sub(na, alt_pos_first[1],alt_pos_first[2]) <- ","
na
names_data <- gsub(",.*","",na)
names_data
names_data <- gsub(".*,","",na)
names_data
data_structure <- function(dataflow){
data <- data_flow() |> dplyr::filter(ids == dataflow)
ref_id <- data[1,3]
agency_id <- data[1,4]
url <- paste0("https://data.un.org/ws/rest/datastructure/",agency_id,"/",ref_id,"/?references=children")
page <- xml2::read_xml(url)
codelist <- xml2::xml_attr(xml2::xml_find_all(page, "//structure:Codelist"),"id")
list_1 <- list()
for(i in 1:length(codelist)){
name <- codelist[i]
as <- paste0(paste("//*[@id = '", name, "'", sep = ""),"]")
data <- data.frame(title = xml2::xml_text(xml2::xml_children(xml2::xml_find_all(page,as))),
id = xml2::xml_attr(xml2::xml_children(xml2::xml_find_all(page, as)),"id"))
data <- data |> tidyr::drop_na()
list_1[[i]] <- data
names_data <- paste0(codelist[i])
alt_pos <- stringr::str_locate_all(names_data, "_")[[1]]
alt_pos_first <- alt_pos[1,]
str_sub(names_data, alt_pos_first[1],alt_pos_first[2]) <- ","
names_data <- gsub(".*,","", names_data)
names(list_1)[i] <- names_data
}
assign(paste0("list_", dataflow), list_1, env = .GlobalEnv)
list_1
}
data_structure("DF_UNData_UNFCC")
View(list_DF_UNData_UNFCC)
get_data <- function(dataflow, filter = NULL, start = NULL , end = NULL){
data <- data_structure(dataflow)
list_1 <- list()
for(i in 1:length(data)){
data_1 <- data[[i]]
name_data <- gsub("/.*","",names(data)[i])
for (a in 1:length(filter)) {
filter_1 <- filter[[a]]
id_filter_1 <- intersect(as.vector(data_1[,2]), as.vector(filter_1))
title_filter_1 <- intersect(name_data, as.vector(filter_1))
if(length(id_filter_1)!=0 & length(title_filter_1)!=0){
d <- c(id_filter_1)
break
}else{
d <- NULL
next
}
}
if(!is.null(d)){
list_1[[i]] <- d
}else{
list_1[[i+1]] <- "as"
list_1[[i+1]] <- d
}
}
get_final_data <- rsdmx::readSDMX(providerId = "UNSD", resource = "data", flowRef = as.character(dataflow),
key = list_1)
get_final_dataset <- data.frame(get_final_data)
get_final_dataset
}
names(list_DF_UNData_UNFCC)
get_data <- function(dataflow, filter = NULL, start = NULL , end = NULL){
data <- data_structure(dataflow)
list_1 <- list()
for(i in 1:length(data)){
data_1 <- data[[i]]
name_data <- names(data)[i]
for (a in 1:length(filter)) {
filter_1 <- filter[[a]]
id_filter_1 <- intersect(as.vector(data_1[,2]), as.vector(filter_1))
title_filter_1 <- intersect(name_data, as.vector(filter_1))
if(length(id_filter_1)!=0 & length(title_filter_1)!=0){
d <- c(id_filter_1)
break
}else{
d <- NULL
next
}
}
if(!is.null(d)){
list_1[[i]] <- d
}else{
list_1[[i+1]] <- "as"
list_1[[i+1]] <- d
}
}
get_final_data <- rsdmx::readSDMX(providerId = "UNSD", resource = "data", flowRef = as.character(dataflow),
key = list_1)
get_final_dataset <- data.frame(get_final_data)
get_final_dataset
}
get_data("DF_UNData_UNFCC",filter = list(c("FREQ","A")))
get_data("DF_UNData_UNFCC",filter = list(c("REF_AREA","DEU"),c("FREQ","A")))
get_data <- function(dataflow, filter = NULL, start = NULL , end = NULL){
data <- data_structure(dataflow)
list_1 <- list()
for(i in 1:length(data)){
data_1 <- data[[i]]
name_data <- names(data)[i]
for (a in 1:length(filter)) {
filter_1 <- filter[[a]]
id_filter_1 <- intersect(as.vector(data_1[,2]), as.vector(filter_1))
title_filter_1 <- intersect(name_data, as.vector(filter_1))
if(length(id_filter_1)!=0 & length(title_filter_1)!=0){
d <- c(id_filter_1)
break
}else{
d <- NULL
next
}
}
if(!is.null(d)){
list_1[[i]] <- d
}else{
list_1[[i+1]] <- "as"
list_1[[i+1]] <- d
}
}
get_final_data <- rsdmx::readSDMX(providerId = "UNSD", resource = "data", flowRef = as.character(dataflow),
key = list_1, start = start, end = end)
get_final_dataset <- data.frame(get_final_data)
get_final_dataset
}
get_data("DF_UNData_UNFCC",filter = list(c("REF_AREA","DEU"),c("FREQ","A")), start = 2010, end= 2015)
library(OECD)
?get_datasets
get_datasets()
devtools::load_all(".")
library(UN)
data_flow()
devtools::load_all(".")
library(UN)
